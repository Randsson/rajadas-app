<div class="container-fluid mt-100 mb-100">
    <div>
        <div>
            <div class="card">
                <div class="card-header"><strong> Detalhes do Arquivo</strong></div>
                 
                <div class="card-body">
                    <div class="table-responsive-sm">
                        <table class="table table-striped">
                            <tbody>
                                 <tr>
                                    <th class="center">Código do convênio</th>
                                    <td class="center"><%= @head[2..21]%></td>
                                </tr>
                            
                                <tr>
                                    <th class="center">Banco</th>
                                    <td class="center"><%= @head[42..44]%> - <%= @head[45..64] %></td>
                                </tr>
                                <tr>
                                    <th class="center">Data Pagamento</th>
                                    <td class="center"><%= [ @cod_leitura[21..24], @cod_leitura[25..26], @cod_leitura[27..28] ].reverse.map{ |s| "#{s}-" }.join[0...-1] %></td>
                                </tr>
                                  <tr>
                                    <th class="right">Valor</th>
                                    <td class="right"><%= number_to_currency_br(@cod_leitura[81..92].insert(-3,'.'))%></td>
                                </tr>
                                <tr>
                                    <th class="center">NSA - Número seqüencial do arquivo</th>
                                    <td class="center"><%= @head[73..78]%></td>
                                </tr>
                                 <tr>
                                    <th class="right">NSR - Número seqüencial do registro</th>
                                    <td class="right"><%= @cod_leitura[100..107] %></td>
                                </tr>
                                <tr>
                                    <th class="right">Agência Arrecadadora</th>
                                    <td class="center"><%= @cod_leitura[108..115] %></td>
                                </tr>
                                <tr>
                                    <th class="right">Forma Arrecadação</th>
                                    <td class="right"><%= @canais_de_recebimento["#{@cod_leitura[116]}"] %></td>
                                </tr>
                                <tr>
                                    <th class="right">Número de Autenticação</th>
                                    <td class="right"><%= @cod_leitura[117..139].sub!(/^0+/,'') %></td>
                                </tr>     
                                <tr>
                                    <th class="center">Código de barra:</th>
                                    <td class="center"><%= @cod_leitura[37..80] %></td>
                                </tr>                              
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header"><strong> <%= @arquivo %> Detalhes do Código de Barra</strong> 
                <% cod_barra = @cod_leitura[37..80]  %>
                </div>
                 
                <div class="card-body">
                    <div class="table-responsive-sm">
                        <table class="table table-striped">
                            <tbody>
                                <tr>
                                    <th class="center">Produto (valor fixo = 8):</th>
                                    <td class="center"><%= cod_barra[0] %></td>
                                </tr>
                                <tr>
                                    <th class="center">Segmento (valor fixo = 2):</th>
                                    <td class="center"><%= cod_barra[1] %></td>
                                </tr>
                                <tr>
                                    <th class="center">Identificação Valor real ou referência:</th>
                                    <td class="center"><%= cod_barra[2] %></td>
                                </tr>
                                <tr>
                                    <th class="center">Dígito verificador geral:</th>
                                    <td class="center"><%= cod_barra[3] %></td>
                                </tr>
                                  <tr>
                                    <th class="center">Valor Efetivo ou de Referência:</th>
                                    <td class="center"><%= cod_barra[4..14].insert(-3, ',').sub(/^0+/, '')  %></td>
                                  </tr>
                                <tr>
                                    <th class="center">Identificação da Empresa</th>
                                    <td class="center"><%= cod_barra[15..18] %></td>
                                </tr>

                                 <tr>
                                    <th class="center">Identificação do Pagamento</th>
                                    <td class="center"><%= cod_barra[19..43] %></td>
                                </tr>                            
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header"><strong> Detalhes da Identificação de Pagamento </strong> 
                <% cod_pag = cod_barra[19..43]  %>
                </div>
                    <div class="card-body">
                        <div class="table-responsive-sm">
                            <table class="table table-striped">
                            
                            <% if cod_pag[24].match(/3/)%>     
                                <tbody>
                                    <tr>
                                        <th class="center">Código da Localidade:</th>
                                        <td class="center"><%= cod_pag[0..2] %> - <%=  @localidades["#{cod_pag[0..2]}"] %></b></td>
                                    </tr>

                                    <tr>
                                        <th class="center">Matrícula do Imóvel:</th>
                                        <% if cod_pag[0..2] == '820' || cod_pag[0..2] == '840' %>
                                            <td class="center"><%= cod_pag[3..11] %></td>
                                        <% else %>
                                            <td class="center"><%= cod_pag[3..12] %></td>  
                                        <% end %>
                                    </tr>
                                        <tr>
                                        <th class="center">Não utilizado (preencher com zero)</th>
                                        <td class="center">000</td>
                                    </tr>

                                    <tr>
                                        <th class="center">Mês e Ano de Referência da Conta (MMAAAA):</th>
                                        <% if cod_pag[0..2] == '820' %>
                                            <td class="center"><%= cod_pag[11..16] %></td>
                                        <% else %>
                                            <td class="center"><%= cod_pag[14..19] %></td>
                                        <% end %>
                                    </tr>

                                    <tr>
                                        <th class="center">Dígito verificador da conta no módulo 10:</th>
                                        <td class="center"><%= cod_pag[20]%></td>
                                    </tr>

                                    <tr>
                                        <th class="center">Tipo de Documento (no caso = 3)</th>
                                        <td class="center"><%= cod_pag[24]%> - Conta </td>
                                    </tr>                            
                                </tbody>
                            <% elsif cod_pag[24].match (/[46]/) %>
                                <tbody>
                                    <tr>
                                        <th class="center">Código da Localidade:</th>
                                        <td class="center"><%= cod_pag[0..2] %></td>
                                    </tr>

                                    <tr>
                                    <% if cod_pag[24] == '4' %>
                                        <th class="center">Matrícula do Imóvel:</th>
                                        <td class="center"><%= cod_pag[3..10] %></td>
                                    <% elsif cod_pag[24] == '6'  %>
                                        <th class="center">Código do Cliente:</th>
                                        <td class="center"><%= cod_pag[3..10] %></td>
                                    <% end %>
                                    </tr>
                                        
                                    <tr>
                                        <th class="center">Não utilizado (preencher com zero)</th>
                                        <td class="center">000</td>
                                    </tr>

                                    <tr>
                                        <th class="center">Código do Tipo do Débito:</th>
                                        <td class="center"><%= cod_pag[14..16] %></td>
                                    </tr>

                                    <tr>
                                        <th class="center">Ano da Emissão da Guia de Pagamento (AAAA):</th>
                                        <td class="center"><%= cod_pag[17..20]%></td>
                                    </tr>

                                    <tr>
                                        <th class="center">Não utilizado (preencher com zero)</th>
                                        <td class="center">000</td>
                                    </tr>

                                    <tr>
                                        <th class="right">Tipo de Documento (no caso = 4 ou 6)</th>
                                        <td class="right"><%= cod_pag[24]%> - Guia de pagamento</td>
                                    </tr>                            
                                </tbody>

                            <% elsif cod_pag[24].match(/5/) %>
                                <tbody>
                                    <tr>
                                        <th class="center">Código da Localidade:</th>
                                        <td class="center"><%= cod_pag[0..2] %> - <%=  @localidades["#{cod_pag[0..2]}"] %></b></td>
                                    </tr>

                                    <tr>
                                        <th class="center">Matrícula do Imóvel:</th>
                                        <td class="center"><%= cod_pag[3..11] %></td>
                                    </tr>
                                        
                                    <tr>
                                        <th class="center">Sequencial do Documento de Cobrança</th>
                                        <td class="center"><%= cod_pag[13..20] %></td>
                                    </tr>

                                    <tr>
                                        <th class="center">Código do Tipo do Documento:</th>
                                        <td class="center"><%= cod_pag[21..22] %></td>
                                    </tr>

                                    <tr>
                                        <th class="right">Tipo de Documento (no caso = 5)</th>
                                        <td class="right"><%= cod_pag[24]%> - Documento de cobrança</td>
                                    </tr>                            
                                </tbody>

                            <% elsif cod_pag[24].match(/8/) %>
                                <tbody>
                                    <tr>
                                        <th class="center">Não utilizado (preencher com zero)</th>
                                        <td class="center"><%= cod_pag[0..2] %></td>
                                    </tr>

                                    <tr>
                                        <th class="center">Código do Cliente:</th>
                                        <td class="center"><%= cod_pag[3..10] %></td>
                                    </tr>
                                        
                                    <tr>
                                        <th class="center">Sequencial do Documento de Cobrança</th>
                                        <td class="center"><%= cod_pag[11..19] %></td>
                                    </tr>

                                    <tr>
                                        <th class="center">Código do Tipo do Documento:</th>
                                        <td class="center"><%= cod_pag[20..21] %></td>
                                    </tr>

                                    <tr>
                                        <th class="center">Não utilizado (preencher com zero)</th>
                                        <td class="center">00</td>
                                    </tr>

                                    <tr>
                                        <th class="right">Tipo de Documento (no caso = 8)</th>
                                        <td class="right"><%= cod_pag[24]%> - Documento gerados para Cliente Responsável</td>
                                    </tr>                            
                                </tbody>

                                
                            <% elsif cod_pag[24].match(/7/) %>
                                <tbody>
                                    <tr>
                                        <th class="center">Código do Cliente</th>
                                        <td class="center"><%= cod_pag[0..8] %></td>
                                    </tr>

                                    <tr>
                                        <th class="center">Não utilizado (preencher com zero):</th>
                                        <td class="center"><%= cod_pag[3..10] %></td>
                                    </tr>
                                        
                                    <tr>
                                        <th class="center">Mês e Ano de Referência das Contas (MMAAAA)</th>
                                        <td class="center"><%= cod_pag[11..16] %></td>
                                    </tr>

                                    <tr>
                                        <th class="center">Dígito verificador da conta no módulo 10:</th>
                                        <td class="center"><%= cod_pag[17] %></td>
                                    </tr>

                                    <tr>
                                        <th class="center">Sequencial da Fatura do Cliente Responsável</th>
                                        <td class="center"><%= cod_pag[18..23] %></td>
                                    </tr>

                                    <tr>
                                        <th class="right">Tipo de Documento (no caso = 7)</th>
                                        <td class="right"><%= cod_pag[24]%> - Fatura do Cliente Responsável</td>
                                    </tr>                            
                                </tbody>

                            <% elsif cod_pag[24].match(/[19]/) %>
                                <tbody>
                                    <tr>
                                        <th class="center">Código da Localidade</th>
                                        <td class="center"><%= cod_pag[0..2] %> - <%=  @localidades["#{cod_pag[0..2]}"] %></b></td>
                                    </tr>

                                    <tr>
                                    <% if cod_pag[24] == '1' %>
                                        <th class="center">Matrícula do Imóvel:</th>
                                        <td class="center"><%= cod_pag[3..11] %></td>
                                    <% elsif cod_pag[24] == '9'  %>
                                        <th class="center">Código do Cliente:</th>
                                        <td class="center"><%= cod_pag[3..10] %></td>
                                    <% end %>
                                    </tr>
                                        
                                    <tr>
                                        <th class="center">Identificador da guia de pagamento:</th>
                                        <td class="center"><%= cod_pag[12..20] %></td>
                                    </tr>
                                    <tr>
                                        <th class="center">Tipo de Documento (no caso = 1 ou 9)</th>
                                        <td class="center"><%= cod_pag[24]%> - Guia de pagamento com identificação </td>
                                    </tr>                            
                                </tbody>                         
                            <% end %>
                            </table>
                        </div>
                    </div>
            </div>
        </div>
    </div><br>
   <span class="navbar-text">
    <button class="btn btn-primary" onClick="window.history.go(-1);">Voltar</button>          
    <%= link_to arquivo_path(params[:format], format: :pdf), class:"btn btn-success" do%>
        <i class="fas fa-file-pdf"></i>Baixar PDF
    <% end %>
</span>
</div>
 