<div class="container-fluid mt-100 mb-100">
    <div>
        <div>
            <div class="card">
                <div class="card-header"><strong> Detalhes do Arquivo</strong> 
                </div>
                 
                <div class="card-body">
                    <div class="table-responsive-sm">
                        <table class="table table-striped">
                            <tbody>
                                <tr>
                                    <th class="center">Banco:</th>
                                    <td class="center"><%= @cod_leitura[59..61] %></td>
                                </tr>
                                <tr>
                                    <th class="center">Código de Registro:</th>
                                    <td class="center"><%= @cod_leitura[59..61] %></td>
                                </tr>
                                <tr>
                                    <th class="center">Código de barra:</th>
                                    <td class="center"><%= @cod_leitura[37..80] %></td>
                                </tr>
                                <tr>
                                    <th class="center">Data Pagamento</th>
                                    <td class="center"><%= [ @cod_leitura[21..24], @cod_leitura[25..26], @cod_leitura[27..28] ].reverse.map{ |s| "#{s}-" }.join[0...-1] %></td>
                                </tr>
                                  <tr>
                                    <th class="right">Valor</th>
                                    <td class="right"><%= number_to_currency_br(@cod_leitura[81..92].insert(-3,'.'))%></td>
                                </tr>
                                 <tr>
                                    <th class="right">NSR</th>
                                    <td class="right"><%= @cod_leitura[100..107] %></td>
                                </tr>
                                <tr>
                                    <th class="right">Agência Arrecadadora</th>
                                    <td class="center"><%= @cod_leitura[108..115] %></td>
                                </tr>
                                <tr>
                                    <th class="right">Forma Arrecadação</th>
                                    <td class="right"><%= @canais_de_recebimento["#{@cod_leitura[116]}"] %></td>
                                </tr>
                                <tr>
                                    <th class="right">Número de Autenticação</th>
                                    <td class="right"><%= @cod_leitura[117..139].sub!(/^0+/,'') %></td>
                                </tr>                                   
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header"><strong> <%= @arquivo %> Detalhes do Código de Barra</strong> 
                <% cod_barra = @cod_leitura[37..80]  %>
                </div>
                 
                <div class="card-body">
                    <div class="table-responsive-sm">
                        <table class="table table-striped">
                            <tbody>
                                <tr>
                                    <th class="center">Produto (valor fixo = 8):</th>
                                    <td class="center"><%= cod_barra[0] %></td>
                                </tr>

                                <tr>
                                    <th class="center">Segmento (valor fixo = 2):</th>
                                    <td class="center"><%= cod_barra[1] %></td>
                                </tr>

                                <tr>
                                    <th class="center">Identificação Valor real ou referência:</th>
                                    <td class="center"><%= cod_barra[2] %></td>
                                </tr>


                                <tr>
                                    <th class="center">Dígito verificador geral:</th>
                                    <td class="center"><%= cod_barra[3] %></td>
                                </tr>

                                  <tr>
                                    <th class="center">Valor Efetivo ou de Referência:</th>
                                    <td class="center"><%= cod_barra[4..14].insert(-3, ',')  %></td>
                                  </tr>



                                <tr>
                                    <th class="center">Identificação da Empresa</th>
                                    <td class="center"><%= cod_barra[15..18] %></td>
                                </tr>

                                 <tr>
                                    <th class="center">Identificação do Pagamento</th>
                                    <td class="center"><%= cod_barra[19..43] %></td>
                                </tr>                            
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header"><strong> Detalhes da Identificação de Pagamento </strong> 
                <% cod_pag = cod_barra[19..43]  %>
                </div>
                        <div class="card-body">
                            <div class="table-responsive-sm">
                                <table class="table table-striped">
                                
                                <% if cod_pag[24].match(/3/)%>     
                                    <tbody>
                                        <tr>
                                            <th class="center">Código da Localidade:</th>
                                            <td class="center"><%= cod_pag[0..2] %> - <%=  @localidades["#{cod_pag[0..2]}"] %></b></td>
                                        </tr>

                                        <tr>
                                            <th class="center">Matrícula do Imóvel:</th>
                                            <% if cod_pag[0..2] == '820' || cod_pag[0..2] == '840' %>
                                                <td class="center"><%= cod_pag[3..11] %></td>
                                            <% else %>
                                                <td class="center"><%= cod_pag[3..12] %></td>  
                                            <% end %>
                                        </tr>

                                         <tr>
                                            <th class="center">Não utilizado (preencher com zero)</th>
                                            <td class="center">000</td>
                                        </tr>

                                        <tr>
                                            <th class="center">Mês e Ano de Referência da Conta (MMAAAA):</th>
                                            <% if cod_pag[0..2] == '820' %>
                                                <td class="center"><%= cod_pag[11..16] %></td>
                                            <% else %>
                                                <td class="center"><%= cod_pag[14..19] %></td>
                                            <% end %>
                                        </tr>

                                        <tr>
                                            <th class="center">Dígito verificador da conta no módulo 10:</th>
                                            <td class="center"><%= cod_pag[20]%></td>
                                        </tr>

                                        <tr>
                                            <th class="center">Tipo de Documento (no caso = 3)</th>
                                            <td class="center"><%= cod_pag[24]%> - Conta </td>
                                        </tr>                            
                                    </tbody>
                                <% elsif cod_pag[24].match (/[46]/) %>
                                    <tbody>
                                        <tr>
                                            <th class="center">Código da Localidade:</th>
                                            <td class="center"><%= cod_pag[0..2] %></td>
                                        </tr>

                                        <tr>
                                        <% if cod_pag[24] == '4' %>
                                            <th class="center">Matrícula do Imóvel:</th>
                                            <td class="center"><%= cod_pag[3..10] %></td>
                                        <% elsif cod_pag[24] == '6'  %>
                                            <th class="center">Código do Cliente:</th>
                                            <td class="center"><%= cod_pag[3..10] %></td>
                                        <% end %>
                                        </tr>
                                          
                                        <tr>
                                            <th class="center">Não utilizado (preencher com zero)</th>
                                            <td class="center">000</td>
                                        </tr>

                                        <tr>
                                            <th class="center">Código do Tipo do Débito:</th>
                                            <td class="center"><%= cod_pag[14..16] %></td>
                                        </tr>

                                        <tr>
                                            <th class="center">Ano da Emissão da Guia de Pagamento (AAAA):</th>
                                            <td class="center"><%= cod_pag[17..20]%></td>
                                        </tr>

                                        <tr>
                                            <th class="center">Não utilizado (preencher com zero)</th>
                                            <td class="center">000</td>
                                        </tr>

                                        <tr>
                                            <th class="right">Tipo de Documento (no caso = 4 ou 6)</th>
                                            <td class="right"><%= cod_pag[24]%> - Guia de pagamento</td>
                                        </tr>                            
                                    </tbody>

                                <% elsif cod_pag[24].match(/5/) %>
                                    <tbody>
                                        <tr>
                                            <th class="center">Código da Localidade:</th>
                                            <td class="center"><%= cod_pag[0..2] %> - <%=  @localidades["#{cod_pag[0..2]}"] %></b></td>
                                        </tr>

                                        <tr>
                                            <th class="center">Matrícula do Imóvel:</th>
                                            <td class="center"><%= cod_pag[3..11] %></td>
                                        </tr>
                                            
                                        <tr>
                                            <th class="center">Sequencial do Documento de Cobrança</th>
                                            <td class="center"><%= cod_pag[13..20] %></td>
                                        </tr>

                                        <tr>
                                            <th class="center">Código do Tipo do Documento:</th>
                                            <td class="center"><%= cod_pag[21..22] %></td>
                                        </tr>

                                      <tr>
                                            <th class="right">Tipo de Documento (no caso = 5)</th>
                                            <td class="right"><%= cod_pag[24]%> - Documento de cobrança</td>
                                        </tr>                            
                                    </tbody>

                                <% elsif cod_pag[24].match(/8/) %>
                                    <tbody>
                                        <tr>
                                            <th class="center">Não utilizado (preencher com zero)</th>
                                            <td class="center"><%= cod_pag[0..2] %></td>
                                        </tr>

                                        <tr>
                                            <th class="center">Código do Cliente:</th>
                                            <td class="center"><%= cod_pag[3..10] %></td>
                                        </tr>
                                            
                                        <tr>
                                            <th class="center">Sequencial do Documento de Cobrança</th>
                                            <td class="center"><%= cod_pag[11..19] %></td>
                                        </tr>

                                        <tr>
                                            <th class="center">Código do Tipo do Documento:</th>
                                            <td class="center"><%= cod_pag[20..21] %></td>
                                        </tr>

                                        <tr>
                                            <th class="center">Não utilizado (preencher com zero)</th>
                                            <td class="center">00</td>
                                        </tr>

                                        <tr>
                                            <th class="right">Tipo de Documento (no caso = 8)</th>
                                            <td class="right"><%= cod_pag[24]%> - Documento gerados para Cliente Responsável</td>
                                        </tr>                            
                                    </tbody>

                                    
                                <% elsif cod_pag[24].match(/7/) %>
                                    <tbody>
                                        <tr>
                                            <th class="center">Código do Cliente</th>
                                            <td class="center"><%= cod_pag[0..8] %></td>
                                        </tr>

                                        <tr>
                                            <th class="center">Não utilizado (preencher com zero):</th>
                                            <td class="center"><%= cod_pag[3..10] %></td>
                                        </tr>
                                            
                                        <tr>
                                            <th class="center">Mês e Ano de Referência das Contas (MMAAAA)</th>
                                            <td class="center"><%= cod_pag[11..16] %></td>
                                        </tr>

                                        <tr>
                                            <th class="center">Dígito verificador da conta no módulo 10:</th>
                                            <td class="center"><%= cod_pag[17] %></td>
                                        </tr>

                                        <tr>
                                            <th class="center">Sequencial da Fatura do Cliente Responsável</th>
                                            <td class="center"><%= cod_pag[18..23] %></td>
                                        </tr>

                                        <tr>
                                            <th class="right">Tipo de Documento (no caso = 7)</th>
                                            <td class="right"><%= cod_pag[24]%> - Fatura do Cliente Responsável</td>
                                        </tr>                            
                                    </tbody>

                                <% elsif cod_pag[24].match(/[19]/) %>
                                    <tbody>
                                        <tr>
                                            <th class="center">Código da Localidade</th>
                                            <td class="center"><%= cod_pag[0..2] %> - <%=  @localidades["#{cod_pag[0..2]}"] %></b></td>
                                        </tr>

                                        <tr>
                                        <% if cod_pag[24] == '1' %>
                                            <th class="center">Matrícula do Imóvel:</th>
                                            <td class="center"><%= cod_pag[3..11] %></td>
                                        <% elsif cod_pag[24] == '9'  %>
                                            <th class="center">Código do Cliente:</th>
                                            <td class="center"><%= cod_pag[3..10] %></td>
                                        <% end %>
                                        </tr>
                                          
                                        <tr>
                                            <th class="center">Identificador da guia de pagamento:</th>
                                            <td class="center"><%= cod_pag[12..20] %></td>
                                        </tr>
                                            
                                        <%# <tr>
                                            <th class="center">Campo não utilizado</th>
                                            <td class="center">XXX</td>
                                        </tr> %>

                                        <tr>
                                            <th class="center">Tipo de Documento (no caso = 1 ou 9)</th>
                                            <td class="center"><%= cod_pag[24]%> - Guia de pagamento com identificação </td>
                                        </tr>                            
                                    </tbody>                         
                                <% end %>
                                </table>
                            </div>
                        </div>
            </div>
        </div>
    </div><br>
    <div class="pull-right"> 
      <%# <a class="btn btn-sm btn-info" href="#" data-abc="true"><i class="fa fa-print mr-1"></i> Imprimir</a> %>
      <input type="button" value="Voltar" onClick="history.go(-1);" class="btn btn-sm btn-info">
  </div>
</div>

<%


# 202010130700142020101300000000826100000005152001282021529477082020000000030000000051520000000000000014640    4000059028              1        0"
# cod_reg = @cod_leitura[0] #Código do registro (fixo = “G”)
# branco = @cod_leitura[1..6]
# data_hora_transacao = @cod_leitura[7..20] #Data/hora da transação (AAAAMMDDHHMMSS)
# data_transicao = "#{@cod_leitura[7..10]}-#{@cod_leitura[11..12]}-#{@cod_leitura[13..14]}"#(AAAAMMDD)
# hora_transicao = "#{@cod_leitura[15..16]},#{@cod_leitura[17..18]},#{@cod_leitura[19..20]}"#(HHMMSS)
# data_pagamento = [ @cod_leitura[21..24], @cod_leitura[25..26], @cod_leitura[27..28] ].reverse.map{ |s| "#{s}-" }.join[0...-1]
# zeros = @cod_leitura[29..36] # Ignorar??
# matricula = @cod_leitura[70..78].sub!(/^0+/,'') 
# cod_barra = @cod_leitura[37..80] # Ignorar??
# valor_recebido = @cod_leitura[81..92].insert(-3, ',').sub!(/^0+/,'') #duas casas decimais
# mais_zeros = @cod_leitura[93..99] # Ignorar??
# nsr =  @cod_leitura[100..107] # Número Seqüencial de Registro 
# cod_agencia_arrecadadora = @cod_leitura[108..115]
# forma_arrecadacao_captura = @cod_leitura[116]
# num_autenticacao_ou_cod_transacao = @cod_leitura[117..139].sub!(/^0+/,'')
# forma_pagamento = @cod_leitura[140]
# reservado = @cod_leitura[141..148]
# tipo_de_transacao = @cod_leitura[149]

# puts normalizado = "Código de registro: #{cod_reg}\nData: #{data_pagamento}\nCódigo de barra: #{cod_barra}\nValor recebido: R$ #{valor_recebido}\nNSR: #{nsr}
# Código da agência arrecadadora: #{cod_agencia_arrecadadora}\nForma de arrecadação: #{forma_arrecadacao_captura}
# Número da autenticação caixa ou código de transação: #{num_autenticacao_ou_cod_transacao}\nForma de pagamento: #{forma_pagamento}"

#  %>