<div class= "table-responsive table-sm">
  <table class="table table-striped table-bordered table-hover">
  <h1>Detalhes do Arquivo</h1>
    
    <thead class="bg-gradient-primary text-white">
      <tr>
        <th class= "">Título</th>
        <th>Descrição</th>
        <th>Arquivos</th>
        <% if @tamanho_barra.first.size > 45 %>
          <th>Valor Total Recebido</th>
        <% end  %>
      </tr>
    </thead>
    <tbody class= "text-primary">
      <tr>
        <td><%=  @arquivo.title %></td>
        <td> <%= @arquivo.body %></td>  
        <td>
          <div class="arquivos-grade">
            <% @arquivo.documento.each do |doc| %>
              <%= link_to doc.filename, rails_blob_path(doc, disposition: :attachment) %>
            <% end %>
          </div>
        </td>
        <% if @tamanho_barra.first.size < 45 %>
          <td>
            <% @valor_total.each do |valor| %>    
              <span style="font-size: 100%;", class="badge badge-info"><%= number_to_currency_br(valor.insert(-3,'.'))%></span>
            <% end %>
          </td>
        <% end %>
      </tr>
    </tbody>
  </table>
</div>

<%= form_with(url: conta_search_index_path(@arquivo),local: true, method: :get) do |f| %>
  <nav class="navbar navbar-expand-lg navbar-light bg-light">
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarText" aria-controls="navbarText" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarText">
  
      <ul class="navbar-nav mr-auto">
        <li class="nav-item">
          <%= form_with(url: conta_search_index_path(@arquivo),local: true, method: :get, class:"nav-link") do |f| %>
            <div class="form-row">
                <div class="form-inline">      
                <%= f.select(:filtro, @campos)%>
                <%= f.text_field :term, class:"form-control mr-sm-2"%>
                <button type="submit" class="btn btn-primary my-2 my-sm-0">Filtrar</button>
            </div>
          <% end %>
        </li>
      </ul>
      <span class="navbar-text">        
        <%= link_to arquivos_path, class:"btn btn-primary my-2 my-sm-0" do %>
            <i class="far fa-file-alt"></i>
            <span>Arquivos</span></a>
        <% end %>
        <%= link_to edit_arquivo_path(@arquivo), class:"btn btn-info my-2 my-sm-0" do %>
          <i class="fas fa-file-signature"></i>Editar
        <% end %>
        <%= link_to arquivo_path(@arquivo, format: :pdf), class:"btn btn-success" do%>
          <i class="fas fa-file-pdf"></i>Baixar PDF
        <% end %>
      </span>
    </div>
  </nav>
<% end %>

 <div class= "table-responsive table-sm" id="table-show ">
    <table class="table table-striped table-bordered">
      <thead class="bg-gradient-primary text-white">
      <th>Arquivo</th>
      <th> Localidade</th>
      <th> Matricula</th>
      <th> Valor</th>
      <th> mes/ano referencia</th>
    </thead>
      <tbody class= "text-primary">
        <% @arquivo.documento.each do |doc| %>
          <tr>
            <td><%= link_to doc.filename, rails_blob_path(doc, disposition: :attachment) %></td>
            <% globo = extrair_cod_barra_filtrado(doc, @termo, @filtro) %>
            <% globo.each do |barra| %>
            <tr>
              <td>
                <% if barra.size > 45 %>
                  <p><%= link_to barra, conta_display_index_path(barra) %></p>
                <% else %>
                  <p><%= link_to barra, conta_cod_barra_index_path(barra) %></p>
                <% end %>
              </td>
              <td><%= barra[19..21] %></td>
              <% if barra[19..21] == '820' || barra[19..21] == '840' %>
                <td class="center"><%= barra[22..29] %></td>
              <% else %>
                <td class="center"><%= barra[22..30] %></td>  
              <% end %>
              <td class="center"><%= barra[4..14].insert(-3, ',').sub!(/^0+/,'')  %></td>
              <% if barra[19..21] == '820' %>
                <td class="center"><%= barra[30..35] %></td>
              <% else %>
                <td class="center"><%= barra[33..38] %></td>
              <% end %>
            <% end %>
            </tr>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>

