<div class= "table-responsive table-sm">
  <table class="table table-striped table-bordered table-hover">
  <h1>Detalhes do Arquivo</h1>
   <% checker = extrair_cod_barra(@arquivo.documento.first) %>
    <thead class="bg-gradient-primary text-white">
      <tr>
        <th class= "">Título</th>
        <th>Descrição</th>
        <th>Arquivos</th>
        <% if checker.first.size > 45 %>
          <th>Valor Total Recebido</th>
        <% end  %>
      </tr>
    </thead>
    <tbody class= "text-primary">
      <tr>
        <td><%=  @arquivo.title %></td>
        <td> <%= @arquivo.body %></td>  
        <td>
          <div class="arquivos-grade">
            <% @arquivo.documento.each do |doc| %>
              <%= link_to doc.filename, rails_blob_path(doc, disposition: :attachment) %>
            <% end %>
          </div>
        </td>
        <% if checker.first.size < 45 %>
          <td>
            <% @valor_total.each do |valor| %>    
              <span style="font-size: 100%;", class="badge badge-info"><%= number_to_currency_br(valor.insert(-3,'.'))%></span>
            <% end %>
          </td>
        <% end %>
      </tr>
    </tbody>
  </table>
</div>

<%= form_with(url: conta_search_index_path(@arquivo),local: true, method: :get) do |f| %>
  <div class="form-row">
      <div class="form-inline">      
      <div id="search-select"><%= f.select(:filtro, @campos)%></div>
      <div class="search-field"><%= f.text_field :term, class:"form-control"%></div>      
      <button type="submit" class="btn btn-primary">Filtrar</button>
  </div>
<% end %>

<% if checker.first.size > 45 %>
  <div class= "table-responsive table-sm" id="table-show">
    <table class="table table-striped table-bordered">
        <thead class="bg-gradient-primary text-white">
        <th>Arquivo</th>
        <th>Qtd de códigos</th>
        <th colspan="100">Códigos de Retorno das Arrecadações Identificadas</th>
      </thead>
      <tbody class= "text-primary">
        <% @arquivo.documento.each do |doc| %>
          <tr>
            <td><%= link_to doc.filename, rails_blob_path(doc, disposition: :attachment) %></td>
            <td><%=extrair_cod_barra_filtrado(doc,@termo, @filtro).size%></td>
            <td>
              <% extrair_cod_barra_filtrado(doc,@termo, @filtro).each do |barra| %>
                <p><%= link_to barra, conta_display_index_path(barra) %></p>
              <% end %>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>
<% else %>
 <div class= "table-responsive table-sm" id="table-show ">
    <table class="table table-striped table-bordered">
      <thead class="bg-gradient-primary text-white">
      <th>Arquivo</th>
      <th> Localidade</th>
      <th> Matricula</th>
      <th> Valor</th>
      <th> mes/ano referencia</th>
    </thead>
      <tbody class= "text-primary">
        <% @arquivo.documento.each do |doc| %>
          <tr>
            <td><%= link_to doc.filename, rails_blob_path(doc, disposition: :attachment) %></td>
            <% globo = extrair_cod_barra_filtrado(doc, @termo, @filtro) %>
            <% globo.each do |barra| %>
            <tr>
              <td>
                <% if barra.size > 45 %>
                  <p><%= link_to barra, conta_display_index_path(barra) %></p>
                <% else %>
                  <p><%= link_to barra, conta_cod_barra_index_path(barra) %></p>
                <% end %>
              </td>
              <td><%= barra[19..21] %></td>
              <% if barra[19..21] == '820' || barra[19..21] == '840' %>
                <td class="center"><%= barra[22..29] %></td>
              <% else %>
                <td class="center"><%= barra[22..30] %></td>  
              <% end %>
              <td class="center"><%= barra[4..14].insert(-3, ',').sub!(/^0+/,'')  %></td>
              <% if barra[19..21] == '820' %>
                <td class="center"><%= barra[30..35] %></td>
              <% else %>
                <td class="center"><%= barra[33..38] %></td>
              <% end %>
            <% end %>
            </tr>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>
<% end %>

<%= link_to 'Editar', edit_arquivo_path(@arquivo), class: 'btn btn-sm btn-info' %>
<%= link_to 'Voltar', arquivos_path, class: 'btn btn-sm btn-info' %><br><br>
<%= link_to "DOWNLOAD PDF", arquivo_path(@arquivo, format: :pdf) %>

